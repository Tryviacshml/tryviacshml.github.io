<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tryvia CS Ecosystem</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;700&family=Roboto:wght@400;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="./styles/tokens.css" />
  <link rel="stylesheet" href="./styles/base.css" />
  <link rel="stylesheet" href="./styles/layout.css" />
  <link rel="stylesheet" href="./styles/components.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style id="shell-override">
    .app-header {
      display: none !important;
    }

    .app-root {
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      padding: 0;
      position: relative;
    }

    .module-frame {
      width: 100vw !important;
      height: 100vh !important;
      border: 0 !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      background: transparent !important;
      opacity: 1;
      transition: opacity 0.3s ease-in-out, filter 0.3s ease-in-out;
    }

    .module-frame.fade-out {
      opacity: 0;
      filter: blur(10px);
    }

    .module-frame.fade-in {
      opacity: 1;
      filter: blur(0);
    }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease-in-out;
    }

    .loading-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 212, 255, 0.1);
      border-top: 4px solid #00d4ff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      position: absolute;
      margin-top: 100px;
      font-family: 'Poppins', 'Roboto', Arial, sans-serif;
      font-weight: 700;
      font-size: 14px;
      color: #00d4ff;
      text-transform: uppercase;
      letter-spacing: 2px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 0.6;
      }

      50% {
        opacity: 1;
      }
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <header class="app-header">
    <div class="header-inner">
      <div class="left">
        <div class="logo-wrap">
          <img class="logo" src="https://tryvia.github.io/dev/logo1.png" alt="Tryvia" />
        </div>
        <nav class="nav-badges">
          <a class="app-badge" data-route="chs" href="#/chs" title="Customer Health Score">CHS</a>
          <a class="app-badge" data-route="nps" href="#/nps" title="Net Promoter Score">NPS</a>
        </nav>
      </div>
      <div class="title-wrapper">
        <div id="siteTitle">Customer Success Ecosystem</div>
        <div id="siteSubtitle">Tryvia</div>
      </div>
      <div class="right"></div>
    </div>
  </header>
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div>
      <div class="loading-spinner"></div>
      <div class="loading-text">Carregando...</div>
    </div>
  </div>

  <main id="app" class="app-root">
    <!-- Fallback inicial: CHS como página principal -->
    <iframe class="module-frame" style="width:100%; height:calc(100vh - 110px);" src="./modules/chs/padrao.html"
      title="Customer Health Score" loading="eager"></iframe>
  </main>
  <script>
    (function () {
      const MODULES = {
        chs: { name: 'Customer Health Score', src: './modules/chs/padrao.html' },
        nps: { name: 'Net Promoter Score', src: './modules/nps/okokok.html' }
      };
      const app = document.getElementById('app');
      function setActive(route) {
        document.querySelectorAll('.app-badge').forEach(a => {
          a.classList.toggle('active', a.dataset.route === route);
        });
      }
      function routeFromHash() {
        const h = (location.hash || '').toLowerCase();
        if (h.startsWith('#/nps')) return 'nps';
        return 'chs';
      }
      function render(route) {
        const mod = MODULES[route] || MODULES.chs;
        const currentFrame = app.querySelector('.module-frame');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Se já existe um iframe, fazer fade out primeiro
        if (currentFrame) {
          // Mostrar loading
          loadingOverlay.classList.add('active');
          currentFrame.classList.add('fade-out');

          setTimeout(() => {
            app.innerHTML = `<iframe class="module-frame fade-in" style="width:100%; height:calc(100vh - 110px);" src="${mod.src}" title="${mod.name}" loading="eager"></iframe>`;
            setActive(route);

            // Esconder loading após um delay para garantir que o iframe começou a carregar
            setTimeout(() => {
              loadingOverlay.classList.remove('active');
            }, 600);
          }, 300);
        } else {
          // Primeira renderização, sem animação
          app.innerHTML = `<iframe class="module-frame" style="width:100%; height:calc(100vh - 110px);" src="${mod.src}" title="${mod.name}" loading="eager"></iframe>`;
          setActive(route);
        }
      }
      window.addEventListener('hashchange', () => render(routeFromHash()));
      // Render immediately to show default CHS without waiting DOMContentLoaded
      render(routeFromHash());
    })();
  </script>
</body>

</html>